"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _vue = _interopRequireDefault(require("vue"));

var _vueMaterial = _interopRequireDefault(require("vue-material"));

var _vuex = _interopRequireDefault(require("vuex"));

var _spinalEnvViewerContextMenuService = require("spinal-env-viewer-context-menu-service");

var _config = require("./config.js");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

_vue.default.config.productionTip = false;

_vue.default.use(_vueMaterial.default);

_vue.default.use(_vuex.default);

function initialState() {
  return {
    topBarButton: [],
    sideBarButton: [],
    contextsId: [],
    nodes: {},
    selectedNode: {},
    graph: {},
    activeNodesId: [],
    childrenMapping: new Map()
  };
}

let store = new _vuex.default.Store({
  state: initialState(),
  mutations: {
    ADD_CONTEXTS: (state, contexts) => {
      for (let i = 0; i < contexts.length; i++) {
        const contextId = contexts[i].id.get();

        if (!state.contextsId.includes(contextId)) {
          state.contextsId.push(contextId);
        }

        if (!state.nodes.hasOwnProperty(contextId)) {
          state.nodes[contextId] = contexts[i];
        }
      }
    },
    ADD_NODE: (state, node) => {
      const nodeId = node.id.get();

      if (!state.nodes.hasOwnProperty(nodeId)) {
        state.nodes[nodeId] = node;
      }
    },
    ADD_NODES: (state, nodes) => {
      for (let i = 0; i < nodes.length; i++) {
        const nodeId = nodes[i].id.get();

        if (!state.nodes.hasOwnProperty(nodeId)) {
          state.nodes[nodeId] = nodes[i];
        }
      }
    },
    CHANGE_SELECTED_NODE: (state, node) => {
      state.selectedNode = node;
      state.selectedNode.graph = state.graph;
    },
    CHANGE_SIDE_BAR: (state, buttons) => {
      const res = [];

      for (let i = 0; i < buttons.length; i++) {
        let button = buttons[i];

        if (button.hasOwnProperty("buttonCfg")) {
          let butcfg = button.buttonCfg;
          butcfg.toolTip = button.label;
          butcfg.action = button.action;
          res.push({
            button: butcfg,
            badge_content: button.badgeCfg
          });
        }
      }

      state.sideBarButton = res;
    },
    REFRESH: state => {
      const s = initialState();

      for (let key in s) {
        if (s.hasOwnProperty(key)) {
          state[key] = s[key];
        }
      }
    },
    REMOVE_NODE: (state, id) => {
      if (state.nodes.hasOwnProperty(id)) {
        state.childrenIds.splice(state.childrenIds.indexOf(id), 1);
        delete state.nodes[id];
      }
    },
    SET_GLOBAL_BAR: (state, bts) => {
      const buttons = [];

      for (let i = 0; i < bts.length; i++) {
        let button = bts[i];

        if (button.hasOwnProperty('buttonCfg')) {
          let butcfg = button.buttonCfg;
          butcfg.toolTip = button.label;
          butcfg.action = button.action;
          buttons.push({
            button: butcfg,
            badge_content: button.badgeCfg
          });
        }
      }

      state.topBarButton = buttons;
    },
    SET_NODE_ID: (state, info) => {
      if (state.nodes.hasOwnProperty(info.id.get())) {
        state.nodes[info.id.get()] = info;
      }
    },
    SET_GRAPH: (state, graph) => {
      state.graph = graph;
    },
    SET_ACTIVE_NODE: (state, activeNode) => {
      state.activeNode = activeNode;
    },
    SET_CHILDREN_MAPPING: (state, mapping) => {
      state.childrenMapping = mapping;
    }
  },
  actions: {
    onNodeSelected(context, ids) {
      const option = {};
      option[_config.OPTION_SELECTED_NODE_INFO] = context.state.nodes[ids[0]];
      option[_config.OPTION_CONTEXT_INFO] = context.state.nodes[ids[ids.length - 1]];

      const promise = _spinalEnvViewerContextMenuService.spinalContextMenuService.getApps("GraphManagerSideBar", option);

      if (typeof promise !== 'undefined') {
        promise.then(buttons => {
          context.commit("CHANGE_SIDE_BAR", buttons);
          context.commit("CHANGE_SELECTED_NODE", option);
        }).catch(e => {
          console.error(e);
        });
      }
    },

    retrieveGlobalBar(context, option) {
      _spinalEnvViewerContextMenuService.spinalContextMenuService.getApps("GraphManagerTopBar", option).then(buttons => {
        context.commit("SET_GLOBAL_BAR", buttons);
        context.commit("CHANGE_SELECTED_NODE", option);
      }).catch(e => {
        console.error(e);
      });
    }

  }
});
var _default = store;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zdG9yZS5qcyJdLCJuYW1lcyI6WyJWdWUiLCJjb25maWciLCJwcm9kdWN0aW9uVGlwIiwidXNlIiwiVnVlTWF0ZXJpYWwiLCJWdWV4IiwiaW5pdGlhbFN0YXRlIiwidG9wQmFyQnV0dG9uIiwic2lkZUJhckJ1dHRvbiIsImNvbnRleHRzSWQiLCJub2RlcyIsInNlbGVjdGVkTm9kZSIsImdyYXBoIiwiYWN0aXZlTm9kZXNJZCIsImNoaWxkcmVuTWFwcGluZyIsIk1hcCIsInN0b3JlIiwiU3RvcmUiLCJzdGF0ZSIsIm11dGF0aW9ucyIsIkFERF9DT05URVhUUyIsImNvbnRleHRzIiwiaSIsImxlbmd0aCIsImNvbnRleHRJZCIsImlkIiwiZ2V0IiwiaW5jbHVkZXMiLCJwdXNoIiwiaGFzT3duUHJvcGVydHkiLCJBRERfTk9ERSIsIm5vZGUiLCJub2RlSWQiLCJBRERfTk9ERVMiLCJDSEFOR0VfU0VMRUNURURfTk9ERSIsIkNIQU5HRV9TSURFX0JBUiIsImJ1dHRvbnMiLCJyZXMiLCJidXR0b24iLCJidXRjZmciLCJidXR0b25DZmciLCJ0b29sVGlwIiwibGFiZWwiLCJhY3Rpb24iLCJiYWRnZV9jb250ZW50IiwiYmFkZ2VDZmciLCJSRUZSRVNIIiwicyIsImtleSIsIlJFTU9WRV9OT0RFIiwiY2hpbGRyZW5JZHMiLCJzcGxpY2UiLCJpbmRleE9mIiwiU0VUX0dMT0JBTF9CQVIiLCJidHMiLCJTRVRfTk9ERV9JRCIsImluZm8iLCJTRVRfR1JBUEgiLCJTRVRfQUNUSVZFX05PREUiLCJhY3RpdmVOb2RlIiwiU0VUX0NISUxEUkVOX01BUFBJTkciLCJtYXBwaW5nIiwiYWN0aW9ucyIsIm9uTm9kZVNlbGVjdGVkIiwiY29udGV4dCIsImlkcyIsIm9wdGlvbiIsIk9QVElPTl9TRUxFQ1RFRF9OT0RFX0lORk8iLCJPUFRJT05fQ09OVEVYVF9JTkZPIiwicHJvbWlzZSIsInNwaW5hbENvbnRleHRNZW51U2VydmljZSIsImdldEFwcHMiLCJ0aGVuIiwiY29t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OEMsT0FBTyxHQUFHQyw0REFBeUJDLE9BQXpCLENBQWtDLHFCQUFsQyxFQUF5REwsTUFBekQsQ0FBaEI7O0FBQ0EsVUFBSSxPQUFPRyxPQUFQLEtBQW1CLFdBQXZCLEVBQW9DO0FBQ2xDQSxRQUFBQSxPQUFPLENBQUNHLElBQVIsQ0FBY3BDLE9BQU8sSUFBSTtBQUN2QjRCLFVBQUFBLE9BQU8sQ0FBQ1MsTUFBUixDQUFnQixpQkFBaEIsRUFBbUNyQyxPQUFuQztBQUNBNEIsVUFBQUEsT0FBTyxDQUFDUyxNQUFSLENBQWdCLHNCQUFoQixFQUF3Q1AsTUFBeEM7QUFDRCxTQUhELEVBSUdRLEtBSkgsQ0FJVUMsQ0FBQyxJQUFJO0FBQ1hDLFVBQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFlRixDQUFmO0FBQ0QsU0FOSDtBQU9EO0FBQ0YsS0FqQk07O0FBbUJQRyxJQUFBQSxpQkFBaUIsQ0FBRWQsT0FBRixFQUFXRSxNQUFYLEVBQW9CO0FBQ25DSSxrRUFBeUJDLE9BQXpCLENBQWtDLG9CQUFsQyxFQUF3REwsTUFBeEQsRUFDR00sSUFESCxDQUNTcEMsT0FBTyxJQUFJO0FBQ2hCNEIsUUFBQUEsT0FBTyxDQUFDUyxNQUFSLENBQWdCLGdCQUFoQixFQUFrQ3JDLE9BQWxDO0FBQ0E0QixRQUFBQSxPQUFPLENBQUNTLE1BQVIsQ0FBZ0Isc0JBQWhCLEVBQXdDUCxNQUF4QztBQUNELE9BSkgsRUFLR1EsS0FMSCxDQUtVQyxDQUFDLElBQUk7QUFDWEMsUUFBQUEsT0FBTyxDQUFDQyxLQUFSLENBQWVGLENBQWY7QUFDRCxPQVBIO0FBUUQ7O0FBNUJNO0FBL0dpQixDQUFoQixDQUFaO2VBaUplM0QsSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBWdWUgZnJvbSAndnVlJztcbmltcG9ydCBWdWVNYXRlcmlhbCBmcm9tICd2dWUtbWF0ZXJpYWwnO1xuaW1wb3J0IFZ1ZXggZnJvbSBcInZ1ZXhcIjtcbmltcG9ydCB7IHNwaW5hbENvbnRleHRNZW51U2VydmljZSB9IGZyb20gXCJzcGluYWwtZW52LXZpZXdlci1jb250ZXh0LW1lbnUtc2VydmljZVwiO1xuaW1wb3J0IHtcbiAgT1BUSU9OX1NFTEVDVEVEX05PREVfSU5GTyxcbiAgT1BUSU9OX0NPTlRFWFRfSU5GT1xufSBmcm9tICcuL2NvbmZpZy5qcyc7XG5cblZ1ZS5jb25maWcucHJvZHVjdGlvblRpcCA9IGZhbHNlO1xuXG5WdWUudXNlKCBWdWVNYXRlcmlhbCApO1xuVnVlLnVzZSggVnVleCApO1xuXG5mdW5jdGlvbiBpbml0aWFsU3RhdGUoKSB7XG4gIHJldHVybiB7XG4gICAgdG9wQmFyQnV0dG9uOiBbXSxcbiAgICBzaWRlQmFyQnV0dG9uOiBbXSxcbiAgICBjb250ZXh0c0lkOiBbXSxcbiAgICBub2Rlczoge30sXG4gICAgc2VsZWN0ZWROb2RlOiB7fSxcbiAgICBncmFwaDoge30sXG4gICAgYWN0aXZlTm9kZXNJZDogW10sXG4gICAgY2hpbGRyZW5NYXBwaW5nOiBuZXcgTWFwKClcbiAgfTtcblxufVxuXG5sZXQgc3RvcmUgPSBuZXcgVnVleC5TdG9yZSgge1xuXG4gIHN0YXRlOiBpbml0aWFsU3RhdGUoKSxcblxuICBtdXRhdGlvbnM6IHtcblxuICAgIEFERF9DT05URVhUUzogKCBzdGF0ZSwgY29udGV4dHMgKSA9PiB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnRleHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHRJZCA9IGNvbnRleHRzW2ldLmlkLmdldCgpO1xuXG4gICAgICAgIGlmICghc3RhdGUuY29udGV4dHNJZC5pbmNsdWRlcyggY29udGV4dElkICkpIHtcbiAgICAgICAgICBzdGF0ZS5jb250ZXh0c0lkLnB1c2goIGNvbnRleHRJZCApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc3RhdGUubm9kZXMuaGFzT3duUHJvcGVydHkoIGNvbnRleHRJZCApKSB7XG4gICAgICAgICAgc3RhdGUubm9kZXNbY29udGV4dElkXSA9IGNvbnRleHRzW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIEFERF9OT0RFOiAoIHN0YXRlLCBub2RlICkgPT4ge1xuICAgICAgY29uc3Qgbm9kZUlkID0gbm9kZS5pZC5nZXQoKTtcbiAgICAgIGlmICghc3RhdGUubm9kZXMuaGFzT3duUHJvcGVydHkoIG5vZGVJZCApKSB7XG4gICAgICAgIHN0YXRlLm5vZGVzW25vZGVJZF0gPSBub2RlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBBRERfTk9ERVM6ICggc3RhdGUsIG5vZGVzICkgPT4ge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBub2RlSWQgPSBub2Rlc1tpXS5pZC5nZXQoKTtcbiAgICAgICAgaWYgKCFzdGF0ZS5ub2Rlcy5oYXNPd25Qcm9wZXJ0eSggbm9kZUlkICkpIHtcbiAgICAgICAgICBzdGF0ZS5ub2Rlc1tub2RlSWRdID0gbm9kZXNbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgQ0hBTkdFX1NFTEVDVEVEX05PREU6ICggc3RhdGUsIG5vZGUgKSA9PiB7XG4gICAgICBzdGF0ZS5zZWxlY3RlZE5vZGUgPSBub2RlO1xuICAgICAgc3RhdGUuc2VsZWN0ZWROb2RlLmdyYXBoID0gc3RhdGUuZ3JhcGg7XG4gICAgfSxcblxuICAgIENIQU5HRV9TSURFX0JBUjogKCBzdGF0ZSwgYnV0dG9ucyApID0+IHtcblxuICAgICAgY29uc3QgcmVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1dHRvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGJ1dHRvbiA9IGJ1dHRvbnNbaV07XG4gICAgICAgIGlmIChidXR0b24uaGFzT3duUHJvcGVydHkoIFwiYnV0dG9uQ2ZnXCIgKSkge1xuICAgICAgICAgIGxldCBidXRjZmcgPSBidXR0b24uYnV0dG9uQ2ZnO1xuICAgICAgICAgIGJ1dGNmZy50b29sVGlwID0gYnV0dG9uLmxhYmVsO1xuICAgICAgICAgIGJ1dGNmZy5hY3Rpb24gPSBidXR0b24uYWN0aW9uO1xuICAgICAgICAgIHJlcy5wdXNoKCB7IGJ1dHRvbjogYnV0Y2ZnLCBiYWRnZV9jb250ZW50OiBidXR0b24uYmFkZ2VDZmcgfSApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHN0YXRlLnNpZGVCYXJCdXR0b24gPSByZXM7XG4gICAgfSxcblxuICAgIFJFRlJFU0g6ICggc3RhdGUgKSA9PiB7XG4gICAgICBjb25zdCBzID0gaW5pdGlhbFN0YXRlKCk7XG5cbiAgICAgIGZvciAobGV0IGtleSBpbiBzKSB7XG4gICAgICAgIGlmIChzLmhhc093blByb3BlcnR5KCBrZXkgKSkge1xuICAgICAgICAgIHN0YXRlW2tleV0gPSBzW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgUkVNT1ZFX05PREU6ICggc3RhdGUsIGlkICkgPT4ge1xuICAgICAgaWYgKHN0YXRlLm5vZGVzLmhhc093blByb3BlcnR5KCBpZCApKSB7XG4gICAgICAgIHN0YXRlLmNoaWxkcmVuSWRzLnNwbGljZSggc3RhdGUuY2hpbGRyZW5JZHMuaW5kZXhPZiggaWQgKSwgMSApO1xuICAgICAgICBkZWxldGUgc3RhdGUubm9kZXNbaWRdO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBTRVRfR0xPQkFMX0JBUjogKCBzdGF0ZSwgYnRzICkgPT4ge1xuICAgICAgY29uc3QgYnV0dG9ucyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGJ1dHRvbiA9IGJ0c1tpXTtcbiAgICAgICAgaWYgKGJ1dHRvbi5oYXNPd25Qcm9wZXJ0eSggJ2J1dHRvbkNmZycgKSkge1xuICAgICAgICAgIGxldCBidXRjZmcgPSBidXR0b24uYnV0dG9uQ2ZnO1xuICAgICAgICAgIGJ1dGNmZy50b29sVGlwID0gYnV0dG9uLmxhYmVsO1xuICAgICAgICAgIGJ1dGNmZy5hY3Rpb24gPSBidXR0b24uYWN0aW9uO1xuICAgICAgICAgIGJ1dHRvbnMucHVzaCgge1xuICAgICAgICAgICAgYnV0dG9uOiBidXRjZmcsXG4gICAgICAgICAgICBiYWRnZV9jb250ZW50OiBidXR0b24uYmFkZ2VDZmdcbiAgICAgICAgICB9ICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgc3RhdGUudG9wQmFyQnV0dG9uID0gYnV0dG9ucztcbiAgICB9LFxuXG4gICAgU0VUX05PREVfSUQ6ICggc3RhdGUsIGluZm8gKSA9PiB7XG4gICAgICBpZiAoc3RhdGUubm9kZXMuaGFzT3duUHJvcGVydHkoIGluZm8uaWQuZ2V0KCkgKSkge1xuICAgICAgICBzdGF0ZS5ub2Rlc1tpbmZvLmlkLmdldCgpXSA9IGluZm87XG5cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgU0VUX0dSQVBIOiAoIHN0YXRlLCBncmFwaCApID0+IHtcbiAgICAgIHN0YXRlLmdyYXBoID0gZ3JhcGg7XG4gICAgfSxcblxuICAgIFNFVF9BQ1RJVkVfTk9ERTogKCBzdGF0ZSwgYWN0aXZlTm9kZSApID0+IHtcbiAgICAgIHN0YXRlLmFjdGl2ZU5vZGUgPSBhY3RpdmVOb2RlO1xuICAgIH0sXG5cbiAgICBTRVRfQ0hJTERSRU5fTUFQUElORzogKHN0YXRlLCBtYXBwaW5nKSA9PiB7XG4gICAgICBzdGF0ZS5jaGlsZHJlbk1hcHBpbmcgPSBtYXBwaW5nO1xuICAgIH1cbiAgfSxcblxuICBhY3Rpb25zOiB7XG5cblxuICAgIG9uTm9kZVNlbGVjdGVkKCBjb250ZXh0LCBpZHMgKSB7XG4gICAgICBjb25zdCBvcHRpb24gPSB7fTtcbiAgICAgIG9wdGlvbltPUFRJT05fU0VMRUNURURfTk9ERV9JTkZPXSA9IGNvbnRleHQuc3RhdGUubm9kZXNbaWRzWzBdXTtcbiAgICAgIG9wdGlvbltPUFRJT05fQ09OVEVYVF9JTkZPXSA9IGNvbnRleHQuc3RhdGUubm9kZXNbaWRzW2lkcy5sZW5ndGggLSAxXV07XG4gICAgICBjb25zdCBwcm9taXNlID0gc3BpbmFsQ29udGV4dE1lbnVTZXJ2aWNlLmdldEFwcHMoIFwiR3JhcGhNYW5hZ2VyU2lkZUJhclwiLCBvcHRpb24gKTtcbiAgICAgIGlmICh0eXBlb2YgcHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcHJvbWlzZS50aGVuKCBidXR0b25zID0+IHtcbiAgICAgICAgICBjb250ZXh0LmNvbW1pdCggXCJDSEFOR0VfU0lERV9CQVJcIiwgYnV0dG9ucyApO1xuICAgICAgICAgIGNvbnRleHQuY29tbWl0KCBcIkNIQU5HRV9TRUxFQ1RFRF9OT0RFXCIsIG9wdGlvbiApO1xuICAgICAgICB9IClcbiAgICAgICAgICAuY2F0Y2goIGUgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvciggZSApO1xuICAgICAgICAgIH0gKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcmV0cmlldmVHbG9iYWxCYXIoIGNvbnRleHQsIG9wdGlvbiApIHtcbiAgICAgIHNwaW5hbENvbnRleHRNZW51U2VydmljZS5nZXRBcHBzKCBcIkdyYXBoTWFuYWdlclRvcEJhclwiLCBvcHRpb24gKVxuICAgICAgICAudGhlbiggYnV0dG9ucyA9PiB7XG4gICAgICAgICAgY29udGV4dC5jb21taXQoIFwiU0VUX0dMT0JBTF9CQVJcIiwgYnV0dG9ucyApO1xuICAgICAgICAgIGNvbnRleHQuY29tbWl0KCBcIkNIQU5HRV9TRUxFQ1RFRF9OT0RFXCIsIG9wdGlvbiApO1xuICAgICAgICB9IClcbiAgICAgICAgLmNhdGNoKCBlID0+IHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCBlICk7XG4gICAgICAgIH0gKTtcbiAgICB9LFxuICB9LFxuXG59ICk7XG5cblxuZXhwb3J0IGRlZmF1bHQgc3RvcmU7Il19